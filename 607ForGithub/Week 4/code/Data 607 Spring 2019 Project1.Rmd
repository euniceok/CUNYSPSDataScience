---
title: "Data 607 Spring 2019 Project1"
author: "Eunice Ok"
date: "2/24/2019"
output: html_document
---

```{r}
library(readr)
library(stringr)
```

```{r}
file = "/Users/euniceok/PycharmProjects/cuny/spring2019/Week4/data/tournamentinfo.txt"
df <- read.table(file, fill=TRUE, header = FALSE, sep='|',stringsAsFactors = FALSE)
dim(df)
```
```{r}
str(df,vec.len=1)
```
```{r}
head(df[,c("V1","V2")])
```
```{r}
df$V1 <- str_replace_all(df$V1,pattern ="[-]","")
class(df[1,c("V1")]) # should be character
```

```{r}
colnames(df) = df[3,] # make the third row the header
df<-df[-1:-4,] # remove first 3 rows

# rename columns 
colnames(df)[1] <-"num" # rename first column with player # 
colnames(df)[2] <-"name" # rename second column with player name
colnames(df)[3] <- "totpts"
colnames(df)[4] <- "round1"
colnames(df)[5] <- "round2"
colnames(df)[6] <- "round3"
colnames(df)[7] <- "round4"
colnames(df)[8] <- "round5"
colnames(df)[9] <- "round6"
colnames(df)[10] <- "round7"

# delete column
df[11] <- NULL

# reset index
rownames(df) <- 1:nrow(df) 

# create a function that deletes every n row
Nth.delete<-function(dataframe, n)dataframe[-(seq(n,to=nrow(dataframe),by=n)),] 
df <- Nth.delete(df,3) # delete every 3rd row 
rownames(df) <- 1:nrow(df) # reset index

df.players = df[seq(1, nrow(df), 2), ] # create a subset dataframe of just player name rows
rownames(df.players) <- 1:nrow(df.players)  # reset index 
df.stats = df[seq(2, nrow(df), 2), ] # create a subset dataframe of the 2nd row of stats for ea player 
rownames(df.stats) <- 1:nrow(df.stats)  # reset index 
colnames(df.stats)[1] <-"state"
colnames(df.stats)[2] <- "id"
df.stats <- df.stats[,c("state","id")]
newdf <- cbind(df.players, df.stats) # join df.stats back wtih df.players on index
newdf$player_id <- str_trim(lapply(str_split(newdf$id, "/"), '[[',1),side="both")
newdf$scores <- str_trim(lapply(str_split(newdf$id,":"), '[[',2), side="both")
newdf$prescore <- str_trim(lapply(str_split(newdf$scores,"->"), '[[',1), side="both")
newdf$postscore <- str_trim(lapply(str_split(newdf$scores,"->"), '[[',2), side="both")
newdf$id <- NULL
newdf$scores <- NULL
newdf$prescore <- str_extract(newdf$prescore,"^[^P]+") # extract only the digits from the prescore (not provisional indicator)
newdf$postscore <- str_extract(newdf$postscore,"^[^P]+") # extract only the digits from the postscore (not provisional indicator)
newdf$prescore <- as.numeric(as.character(newdf$prescore)) # convert both scores to numeric
newdf$postscore <- as.numeric(as.character(newdf$postscore))
newdf$round1 <- str_replace_all(str_replace_all(newdf$round1, pattern = "[[:alpha:]]", ""), pattern="\\s+","")

# clean up round columns
rounds <- c('round1','round2','round3','round4','round5','round6','round7')
therounds = newdf[rounds]
therounds <- lapply(therounds, function(x) {
  str_replace_all(str_replace_all(x, pattern = "[[:alpha:]]", ""),pattern="\\s+","")
  })

# remove old round columns and join with clean round columns
newdf <- subset(newdf, select = -c(round1,round2,round3,round4,round5,round6,round7))
newdf <- cbind(newdf, therounds)
```

```{r}
head(newdf,n=10)
```


```{r}
# not sure how to average the opponents scores in R. write temporary csv to complete rest of assignment in python
write.csv(newdf, file = "/Users/euniceok/PycharmProjects/cuny/spring2019/Week4/output/tournamenttmpdf.csv")

# Final output
# Player’s Name, Player’s State, Total Number of Points, Player’s Pre-Rating, and Average Pre Chess Rating of Opponents
```

